# PortFly 开发待办清单

## 项目概述
基于Go和SSH2的端口转发工具，包含命令行工具、HTTP API服务器和Angular可视化前端。

## 开发阶段规划

### 第一阶段：核心引擎开发 (core/)
**优先级：🔥 高优先级**

#### SSH连接管理
- [ ] **创建SSH客户端基础结构** (`core/ssh/client.go`)
  - [ ] 实现SSH连接池管理
  - [ ] 连接状态监控和自动重连
  - [ ] 连接超时处理

- [ ] **实现认证系统** (`core/ssh/auth.go`)
  - [ ] 支持密码认证
  - [ ] 支持SSH密钥认证
  - [ ] 支持SSH Agent认证
  - [ ] 认证方式自动选择机制

- [ ] **端口转发核心逻辑** (`core/ssh/tunnel.go`)
  - [ ] 本地端口转发 (Local Forward)
  - [ ] 远程端口转发 (Remote Forward)
  - [ ] 动态端口转发 (SOCKS代理)
  - [ ] 转发流量统计

#### 数据模型和配置
- [ ] **定义核心数据结构** (`core/models/`)
  - [ ] Session结构体 (会话信息)
  - [ ] Config结构体 (配置信息)
  - [ ] Rule结构体 (转发规则)

- [ ] **会话管理器** (`core/manager/session_manager.go`)
  - [ ] 会话创建、启动、停止
  - [ ] 会话状态管理
  - [ ] 并发安全的会话存储

- [ ] **规则管理器** (`core/manager/rule_manager.go`)
  - [ ] 转发规则的增删改查
  - [ ] 规则验证和冲突检测
  - [ ] 规则持久化存储

#### 工具模块
- [ ] **加密工具** (`core/ssh/crypto_utils.go`)
  - [ ] 私钥文件加解密
  - [ ] 配置文件敏感信息加密

- [ ] **网络工具** (`core/utils/network_utils.go`)
  - [ ] 端口可用性检测
  - [ ] IP地址验证
  - [ ] 网络连通性测试

- [ ] **日志系统** (`core/utils/logger.go`)
  - [ ] 统一日志接口
  - [ ] 日志级别控制
  - [ ] 日志文件轮转

#### 核心引擎测试
- [ ] **单元测试**
  - [ ] SSH客户端连接测试
  - [ ] 端口转发功能测试
  - [ ] 认证模块测试
  - [ ] 会话管理器测试

---

### 第二阶段：命令行工具开发 (cli/)
**优先级：🔥 高优先级**

#### 命令结构
- [ ] **根命令** (`cli/cmd/root.go`)
  - [ ] 全局配置选项
  - [ ] 版本信息显示
  - [ ] 帮助信息格式化

- [ ] **启动命令** (`cli/cmd/start.go`)
  - [ ] 快速启动转发 (`port-fly start -L 8080:192.168.1.100:80 user@host`)
  - [ ] 配置文件启动
  - [ ] 后台运行模式
  - [ ] 交互式配置向导

- [ ] **管理命令**
  - [ ] 停止转发 (`cli/cmd/stop.go`)
  - [ ] 列出活动会话 (`cli/cmd/list.go`)
  - [ ] 配置管理 (`cli/cmd/config.go`)

#### 用户体验
- [ ] **控制台输出** (`cli/console/output.go`)
  - [ ] 彩色输出支持
  - [ ] 表格化显示会话信息
  - [ ] 进度条显示

- [ ] **交互式功能** (`cli/console/interactive.go`)
  - [ ] 配置向导
  - [ ] 确认提示
  - [ ] 密码安全输入

#### CLI测试
- [ ] **功能测试**
  - [ ] 各命令功能验证
  - [ ] 参数解析测试
  - [ ] 错误处理测试

---

### 第三阶段：HTTP API服务器开发 (server/)
**优先级：🔥 高优先级**

#### API接口设计
- [ ] **会话管理API** (`server/api/v1/session_handler.go`)
  - [ ] `POST /api/v1/sessions` - 创建会话
  - [ ] `GET /api/v1/sessions` - 获取会话列表
  - [ ] `GET /api/v1/sessions/{id}` - 获取会话详情
  - [ ] `DELETE /api/v1/sessions/{id}` - 停止会话
  - [ ] `PUT /api/v1/sessions/{id}` - 更新会话

- [ ] **规则管理API** (`server/api/v1/rule_handler.go`)
  - [ ] `POST /api/v1/rules` - 创建转发规则
  - [ ] `GET /api/v1/rules` - 获取规则列表
  - [ ] `PUT /api/v1/rules/{id}` - 更新规则
  - [ ] `DELETE /api/v1/rules/{id}` - 删除规则

#### 中间件
- [ ] **认证中间件** (`server/middleware/auth.go`)
  - [ ] JWT token验证
  - [ ] 用户权限检查
  - [ ] API访问控制

- [ ] **日志中间件** (`server/middleware/logger.go`)
  - [ ] 请求/响应日志记录
  - [ ] 访问统计
  - [ ] 错误追踪

#### 实时通信
- [ ] **WebSocket支持** (`server/websocket/log_stream.go`)
  - [ ] 实时日志推送
  - [ ] 会话状态变更通知
  - [ ] 流量统计实时更新

#### 数据持久化
- [ ] **BoltDB存储** (`server/storage/boltdb_store.go`)
  - [ ] 会话数据持久化
  - [ ] 规则配置存储
  - [ ] 用户配置管理

#### 服务器测试
- [ ] **API测试**
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] 性能测试
  - [ ] 并发测试

---

### 第四阶段：项目基础设施
**优先级：🔶 中优先级**

#### 项目配置
- [ ] **Go模块初始化**
  - [ ] `go.mod` 配置
  - [ ] 依赖管理
  - [ ] 版本控制

- [ ] **配置文件** (`configs/`)
  - [ ] 默认配置模板
  - [ ] 环境变量支持
  - [ ] 配置验证

#### 构建和部署
- [ ] **Makefile**
  - [ ] 编译脚本
  - [ ] 测试脚本
  - [ ] 发布脚本

- [ ] **CI/CD配置**
  - [ ] GitHub Actions工作流
  - [ ] 自动化测试
  - [ ] 发布流水线

#### 文档
- [ ] **技术文档**
  - [ ] API文档 (使用Swagger)
  - [ ] 代码注释完善
  - [ ] 架构设计文档

- [ ] **用户文档**
  - [ ] 安装指南
  - [ ] 使用教程
  - [ ] 常见问题解答

---

### 第五阶段：Angular前端开发 (web-ui/)
**优先级：🔶 中优先级 (后端完成后开始)**

#### 项目结构
- [ ] **Angular项目初始化**
  - [ ] 创建Angular项目
  - [ ] 配置Angular Material
  - [ ] 设置路由结构

#### 核心服务
- [ ] **API服务** (`src/app/services/api.service.ts`)
  - [ ] HTTP客户端封装
  - [ ] 错误处理
  - [ ] 请求拦截器

- [ ] **WebSocket服务** (`src/app/services/ws.service.ts`)
  - [ ] 实时数据订阅
  - [ ] 连接管理
  - [ ] 消息处理

#### 页面组件
- [ ] **仪表盘** (`src/app/pages/dashboard/`)
  - [ ] 会话概览
  - [ ] 实时统计图表
  - [ ] 快速操作面板

- [ ] **会话管理** (`src/app/pages/session-mgmt/`)
  - [ ] 会话列表展示
  - [ ] 会话创建/编辑
  - [ ] 会话控制操作

- [ ] **规则编辑器** (`src/app/pages/rule-editor/`)
  - [ ] 可视化规则配置
  - [ ] 规则验证
  - [ ] 批量操作

- [ ] **实时日志** (`src/app/pages/logs/`)
  - [ ] 日志流展示
  - [ ] 日志过滤
  - [ ] 日志导出

#### UI组件
- [ ] **会话卡片** (`src/app/components/session-card/`)
- [ ] **端口可视化** (`src/app/components/port-visualizer/`)
- [ ] **统计图表组件**

#### 前端测试
- [ ] **单元测试**
- [ ] **端到端测试**
- [ ] **用户体验测试**

---

## 开发里程碑

### 🎯 里程碑1：核心功能完成 (第1-3阶段)
- 基本SSH端口转发功能
- 命令行工具可用
- HTTP API服务可用

### 🎯 里程碑2：完整后端系统 (第4阶段)
- 完整的项目构建体系
- 完备的文档和测试
- 可部署的后端服务

### 🎯 里程碑3：全功能产品 (第5阶段)
- Angular前端完成
- 前后端集成测试
- 产品化包装

## 技术债务和优化

### 性能优化
- [ ] 连接池优化
- [ ] 内存使用优化
- [ ] 并发性能调优

### 安全加固
- [ ] 安全审计
- [ ] 漏洞扫描
- [ ] 加密强度提升

### 用户体验
- [ ] 错误信息优化
- [ ] 界面响应性优化
- [ ] 移动端适配

---

## 当前重点：立即开始第一阶段核心引擎开发

建议按照以下顺序开始：
1. 初始化Go项目和模块结构
2. 实现基础SSH连接功能
3. 开发端口转发核心逻辑
4. 创建会话管理器
5. 编写单元测试验证功能
